## DNS Enumeration

DNS enumeration is the process of finding all the DNS servers and their corresponding records for an organization. Like usernames, computer names, and IP addresses of target systems.

### Impact

An attacker can use this information to obtain the internal network information if the DNS server is vulnerable to Zone Transfer Attack.

## nmap

  -Pn: Treat all hosts as online -- skip host discovery
  -sS/sT/sA/sW/sM: TCP SYN/Connect()/ACK/Window/Maimon scans
  -sU: Scan UDP Port
  -p <port ranges>: Only scan specified ports
  -sV: Probe open ports to determine service/version info
  -sC: equivalent to --script=default
  --script=<Lua scripts>: <Lua scripts> is a comma separated list of
           directories, script-files or script-categories
  -O: Enable OS detection
  -oA <basename>: Output in the three major formats at once
  -v: Increase verbosity level (use -vv or more for greater effect)
  -A: Enable OS detection, version detection, script scanning, and traceroute

### Detecting Open Port

	# nmap -v -sT -sU -p T:53,U:53 $IP
	# nmap -v -sT -sU -p T:53,U:53 192.168.1.100

### Tools

#### dnsenum

	--noreverse           Skip the reverse lookup operations.
	-p, --pages <value>   The number of google search pages to process when scraping names,
    -s, --scrap <value>   The maximum number of subdomains that will be scraped from Google (default 15)
    --dnsserver   <server>

	# dnsenum --noreverse example.com

	# dnsenum --noreverse -o out.xml example.com

	# dnsenum --dnsserver <DNS_Server_Address> <Domain> -p <Pages> -s <Subdomain_Scrap>

	# dnsenum --dnsserver 192.168.1.100 example.tk -p 10 -s 50

#### nslookup

	# nslookup <Server_IP/Domain> <DNS_Server_Address>

	# nslookup 192.168.1.100 192.168.1.1

	# nslookup --type=PTR 192.168.1.100 192.168.1.1

	# nslookup --type=A example.tk 192.168.1.1

	# nslookup -type=NS example.tk 192.168.1.1

	# nslookup -type=MX example.tk 192.168.1.1

#### dig

	# dig <domain> @<DNS_Server_Address>

	# dig example.tk @192.168.1.100

	# dig A example.tk @192.168.1.100

	# dig AAAA example.tk @192.168.1.100

	# dig CNAME example.tk @192.168.1.100

	# dig NS example.tk @192.168.1.100

#### host

	-t specifies the query type

	# host -t A <Domain> <DNS_Server_Address>

	# host -t A example.tk 192.168.1.32

	# host -t NS example.tk 192.168.1.32

	# host -t AAAA example.tk 192.168.1.32

	# host -t CNAME example.tk 192.168.1.32

	# host -t PTR 192.168.1.32 192.168.1.32

### DNS Zone Transfer

Zone Transfer can be applicable on Both Forward and Reverse Zone, if zone transfer is allow to all ip. It can be done in three steps.

### 1. Find Name Server

	# nslookup -type=ns example.tk 192.168.1.100

	# dig NS example.tk @192.168.1.100

	# host -t ns example.tk 192.168.1.100

	# dig NS zonetransfer.me

### 2. Find Name Server IP Address

	# nslookup -type=A server.example.tk 192.168.1.100

	# dig A server.example.tk @192.168.1.100

	# host -t A server.example.tk 192.168.1.100

	# dig A nsztm2.digi.ninja

### 3. Transfer Target Zone

	# nslookup -type=axfr example.tk 192.168.1.100

	# dig AXFR example.tk @192.168.1.100

	# host -t AXFR example.tk 192.168.1.100

	# dig AXFR zonetransfer.me @nsztm2.digi.ninja

## Subdomain Enumerate Tool

### 1. massdns
	
	https://github.com/blechschmidt/massdns

	# git clone https://github.com/blechschmidt/massdns
	
	# cd massdns/

	# make

	# cp bin/massdns /usr/bin/

	# massdns -h
	-r  --resolvers        Text file containing DNS resolvers.
	-t  --type             Record type to be resolved. (Default: A)
	-w  --outfile          Write to the specified output file instead of standard output.
	-o  --output           Flags for output formatting.

	# massdns -r lists/resolvers.txt -t AAAA /dev/shm/domain.txt

	# massdns -r lists/resolvers.txt -t NS /dev/shm/domain.txt > /dev/shm/NS.txt

	# massdns -r lists/resolvers.txt -t SOA /dev/shm/domain.txt -w /dev/shm/SOA.txt

	# massdns -r lists/resolvers.txt -t PTR /dev/shm/domain.txt -w /dev/shm/PTR.txt

	# massdns -r lists/resolvers.txt -t CNAME /dev/shm/domain.txt -w /dev/shm/CNAME.txt
	
	# massdns -r lists/resolvers.txt /dev/shm/domain.txt -t A -o S -w /dev/shm/results.txt

### 2. subfinder

	https://github.com/projectdiscovery/subfinder

	# GO111MODULE=on go get -v github.com/projectdiscovery/subfinder/v2/cmd/subfinder

	# cp /root/go/bin/subfinder /usr/bin/subfinder

	# subfinder --help
	-d string        Domain to find subdomains for
	-dL string       File containing list of domains to enumerate
	-nW        Remove Wildcard & Dead Subdomains from output
	-rL string        Text file containing list of resolvers to use
	-silent        Show only subdomains in output
	-o string        File to write output to (optional)
	
	# subfinder -d example.com

	# subfinder -d example.com -v
	
	# subfinder -d example.com -all -v

	# subfinder -d example.com -recursive

	# subfinder -dL /dev/shm/domain.txt

	# subfinder -d example.com -nW

	# subfinder -d example.com -nW -rL /opt/Tools/massdns/lists/resolvers.txt

	# subfinder -d example.com -silent

	# subfinder -d example.com -nW -silent -o /dev/shm/result.txt